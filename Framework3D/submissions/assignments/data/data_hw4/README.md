# USD (Universal Scene Description) 网格简介

## 1. USD 简介

USD（Universal Scene Description）是一个用于描述、组织和交换复杂的3D场景结构的框架，由Pixar开发。它能够描述动画和静态的场景信息，包括几何形状、着色器、光照、动画以及虚拟现实内容等。USD的设计旨在支持高性能的读写操作，并能够在多个软件包之间轻松交换数据。

## 2. USD 数据结构

USD文件可以使用几种不同的格式来存储数据，包括基于文本的.usda（ASCII格式）、.usdc（二进制格式）和.usdz（用于压缩交换的包格式）。每种格式都旨在满足特定的使用场景需求，.usda格式因其可读性而被广泛用于文档和初始阶段的数据交换。

## 2.1 网格（Mesh）概念

在USD中，网格是一种用于表示3D物体表面的基本几何结构。它由一系列的顶点、边和面（通常是多边形，如三角形或四边形）构成。网格可以用于描述从简单的形状（如立方体或球体）到极其复杂的模型（如详细的角色或环境）的几何结构。

## 2.2 USDA 格式中的网格表示

在.usda格式的文件中，网格数据以一种易于阅读和编辑的方式存储。以下是一个简单的例子，展示了如何在.usda文件中表示一个基本的三角形网格：

```python
#usda 1.0
(
    doc = "一个简单的三角形网格示例"
)

def Mesh "SimpleTriangle"
{
    int[] faceVertexCounts = [3]
    int[] faceVertexIndices = [0, 1, 2]
    point3f[] points = [(0,0,0), (1,0,0), (0,1,0)]
    normal3f[] normals = [(0,0,1)] # 面法线
    uniform token subdivisionScheme = "none"
}
```

这个例子中的关键元素包括：

- `faceVertexCounts`: 指定每个面有多少个顶点。在这个例子中，我们有一个面，它是一个三角形，因此这个数组包含一个元素3。
- `faceVertexIndices`: 定义了构成面的顶点的索引。这些索引引用了下面points数组中的顶点。
- `points`: 包含网格顶点的位置。在这个例子中，定义了一个三角形的三个顶点。
- `normals`: 定义了网格的法线，用于渲染和光照计算。这里假设整个网格有一个统一的法线方向。
- `subdivisionScheme`: 定义了网格细分的策略。在许多情况下，这可以用于在渲染时动态增加网格的细节级别。

## 网格示例数据

我们提供了若干[网格数据](../data/meshes/)，可以通过以下方式查看：

- 使用 `usdview` 查看 USD 数据
- 使用作业框架读取 USD 数据

## 补充：其他网格存储结构及示例

除了 USD 格式，还有其他的常用几何数据格式，例如：

### 1. OBJ格式
OBJ格式是一种广泛使用的简单文本文件格式，用于表示3D几何信息。它支持顶点位置、纹理坐标、法线和面的定义。

#### 示例:

```
# 一个简单的立方体OBJ例子
v 0.0 0.0 0.0
v 1.0 0.0 0.0
v 1.0 1.0 0.0
v 0.0 1.0 0.0
v 0.0 0.0 1.0
v 1.0 0.0 1.0
v 1.0 1.0 1.0
v 0.0 1.0 1.0

f 1 2 3 4
f 5 8 7 6
f 1 5 6 2
f 3 7 8 4
f 1 4 8 5
f 2 6 7 3
```

在这个例子中，v代表一个顶点的位置，f定义了一个面，即由顶点索引组成的多边形。

### 2. STL格式

STL格式是3D打印领域中使用非常广泛的一种文件格式，它仅包含用于描述物体表面的三角形网格。

#### 示例 (ASCII STL):

```
solid cube
  facet normal 0 0 1
    outer loop
      vertex 0 0 1
      vertex 1 0 1
      vertex 1 1 1
    endloop
  endfacet
  ... // 更多的facet定义
endsolid cube
```

这个简化的示例展示了STL格式如何定义一个面（facet），包括它的法线（normal）和构成这个面的顶点（vertex）。

### 3. FBX格式

FBX（Filmbox）格式是一个用于交换复杂3D动画的文件格式，它支持3D模型、动画、摄像机和灯光等场景数据的存储。FBX可以是二进制或ASCII文本格式，支持从一个应用程序到另一个应用程序之间的广泛兼容性。由于其丰富的特性集，FBX成为了3D动画和游戏开发中的一种重要格式。

